name: ubuntu-merges
type: charm
title: Ubuntu Merges charm
summary: Generate merges reports for Ubuntu
description: |
  **Ubuntu Merges Operator** is a [charm](https://juju.is/charms-architecture)
  for building merges reports for Ubuntu.


links:
  website:
    - https://charmhub.io/ubuntu-merges
  issues:
    - https://github.com/canonical/ubuntu-merges-operator/issues
  source:
    - https://github.com/canonical/ubuntu-merges-operator


base: ubuntu@24.04
platforms:
  amd64:

parts:
  ubuntu-merges-charm:
    source: .
    plugin: uv
    build-packages: [git]
    build-snaps: [astral-uv]
    override-build: |
      craftctl default  # Run the default build steps.
      git describe --always > $CRAFT_PART_INSTALL/version
  ubuntu-merges-app:
    plugin: dump
    source: .
    prime:
      - app/

charm-libs:
  - lib: operator_libs_linux.systemd
    version: "1"
  - lib: traefik_k8s.ingress
    version: "2"

actions:
  refresh:
    description: |
      Refresh the content of the merges report

requires:
  merges-ingress:
    interface: ingress
    limit: 1
    optional: true
  patches-ingress:
    interface: ingress
    limit: 1
    optional: true
